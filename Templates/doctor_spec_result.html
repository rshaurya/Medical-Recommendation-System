<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prediction Results</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/doctor_spec_style.css') }}" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="bg-light">

  <div class="container py-5">
    <div class="row g-4 justify-content-center">
      <div class="col-lg-10">
        <div class="card shadow-lg rounded-4">
          <div class="card-body p-4 p-md-5">
            <h2 class="text-center mb-4 fw-bold text-success">‚úÖ Prediction Results</h2>

            <!-- Selected Symptoms -->
            <div class="mb-4">
              <h5 class="fw-semibold mb-2">Your Selected Symptoms</h5>
              {% if symptoms_selected %}
                <div class="d-flex flex-wrap gap-2">
                  {% for s in symptoms_selected %}
                    <span class="badge text-bg-primary px-3 py-2">{{ s }}</span>
                  {% endfor %}
                </div>
              {% else %}
                <p class="text-muted mb-0">No symptoms received.</p>
              {% endif %}
            </div>

            <!-- Predicted Diseases -->
            <div class="mb-4">
              <h5 class="fw-semibold">Predicted Diseases (Threshold: {{ threshold }}%)</h5>
              <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                  <thead class="table-dark">
                    <tr>
                      <th>Disease</th>
                      <th>Probability (%)</th>
                      <th>Recommended Specialist</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for r in results %}
                      <tr>
                        <td class="fw-semibold">{{ r['Disease'] }}</td>
                        <td>{{ (r['Chances (%)'] | float) | round(2) }}</td>
                        <td>{{ r['Specialist'] }}</td>
                        <td style="min-width: 320px;">{{ r['Description'] }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Chart + Actions -->
            <div class="row align-items-center g-4">
              <div class="col-12 col-lg-6">
                <h6 class="fw-semibold mb-3">Probability Chart</h6>
                <canvas id="probChart" height="220"></canvas>
              </div>
              <div class="col-12 col-lg-6 d-flex flex-column align-items-center justify-content-center">
                <!-- ‚úÖ Corrected Blueprint path -->
                <a href="{{ url_for('doctor_spec.download_csv') }}" class="btn btn-success btn-lg w-100 mb-3">
                  ‚¨áÔ∏è Download Results (CSV)
                </a>
                <a href="{{ url_for('doctor_spec.index') }}" class="btn btn-secondary btn-lg w-100">
                  üîô Back
                </a>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js Script -->
  <script>
    const labels = {{ chart_labels | tojson }};
    const dataVals = {{ chart_values | tojson }};
    const ctx = document.getElementById('probChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Chances (%)',
          data: dataVals,
          backgroundColor: 'rgba(25, 135, 84, 0.7)', // bootstrap green
          borderColor: 'rgba(25, 135, 84, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Probability (%)' } },
          x: { title: { display: true, text: 'Disease' } }
        }
      }
    });
  </script>

</body>
</html>

